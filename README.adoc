
== Build and run a Cloudera trial environment in a dockerless container

Based on https://github.com/carrossoni/CDPDCTrial/

----
We'll use 
buildah to create the Cloudera trial environment container and
podman to run it

Buildah is a command-line tool for building Open Container Initiative-compatible 
(that means Docker- and Kubernetes-compatible, too) images quickly and easily. 
Buildah is easy to incorporate into scripts and build pipelines and 
doesnâ€™t require a running container daemon to build its image.
See more at https://opensource.com/article/18/6/getting-started-buildah
----


The buildah script to create the container is at https://github.com/marcredhat/cloudera/blob/master/build.sh


----
buildah containers
CONTAINER ID  BUILDER  IMAGE ID     IMAGE NAME                       CONTAINER NAME
264060d4de76     *     91d23a64fdf2 registry.access.redhat.com/ub... ubi-minimal-working-container-3
----

----
buildah commit ubi-minimal-working-container-3 ubiawx
----

----
buildah images
localhost/ubiawx
----

----
podman  login -u="<quay user>" -p="<your quay token>" quay.io

podman push localhost/ubiawx quay.io/marcf5/ubiawx
----


----
oc create secret docker-registry staging-secret \
    --docker-server=quay.io \
    --docker-username=<quay user> \
    --docker-password='<quay user token>' \
    --docker-email='<quay user email>' \
    --dry-run -o yaml > secret
----

----
oc create -f secret
----


----
apiVersion: v1
kind: ServiceAccount
metadata:
  name: awxsa
imagePullSecrets:
  - name: staging-secret
----


----
oc create secret generic tower-creds \
         --from-literal=password=admin \
         --from-literal=username=password \
         --from-literal=PASS=admin \
         --from-literal=USER=password \
         --type=kubernetes.io/basic-auth
----


----
oc create -f https://raw.githubusercontent.com/marcredhat/awxcli/master/ansible-tower-cli-task.yaml
----


----
oc create -f https://raw.githubusercontent.com/marcredhat/awxcli/master/ansible-tower-cli-taskrun.yaml
----

----
If you want test outside Tekton:
podman run -it quay.io/marcf5/ubiawx /bin/bash
awx -k --conf.host "https://<Ansible Tower server>"  --conf.username "admin" --conf.password "password" --conf.insecure  workflow_job_templates launch "<Ansible Tower workflow"
----
